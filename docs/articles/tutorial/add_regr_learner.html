<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add a Regression Learner • mlr3learners</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Add a Regression Learner">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">mlr3learners</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Add Learners
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/tutorial/add_classif_learner.html">Classification</a>
    </li>
    <li>
      <a href="../../articles/tutorial/add_regr_learner.html">Regression</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlr3learners">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Add a Regression Learner</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr3learners/blob/master/vignettes/tutorial/add_regr_learner.Rmd"><code>vignettes/tutorial/add_regr_learner.Rmd</code></a></small>
      <div class="hidden name"><code>add_regr_learner.Rmd</code></div>

    </div>

    
    
<div id="step-by-step-guide" class="section level1">
<h1 class="hasAnchor">
<a href="#step-by-step-guide" class="anchor"></a>Step-By-Step Guide</h1>
<p>To implement a regression learner, you have to create an R6 reference object, which inherits from <code>LeanerRegr</code>.</p>
<p>Here we show step-by-step, how we implemented the random forest algorithm from <code>ranger</code>. Basically, we need to put information about the learner’s name, package, parameter set, properties and how to use the learner’s <code>train</code> and <code>predict</code> function into the following skeleton:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LearnerRegrYourLearner =<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">"LearnerRegrYourLearner"</span>, <span class="dt">inherit =</span> LearnerRegr,
  <span class="dt">public =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
    <span class="dt">initialize =</span> <span class="cf">function</span>(<span class="dt">id =</span> <span class="st">"regr.yourlearner"</span>) {
      super<span class="op">$</span><span class="kw">initialize</span>(
        <span class="dt">id =</span> id,
        <span class="dt">packages =</span> ,
        <span class="dt">feature_types =</span> ,
        <span class="dt">predict_types =</span> ,
        <span class="dt">param_set =</span> ParamSet<span class="op">$</span><span class="kw">new</span>(
          <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()
        ),
        <span class="dt">properties =</span> 
      )
    },

    <span class="dt">train =</span> <span class="cf">function</span>(task) {
    
    },
    <span class="dt">predict =</span> <span class="cf">function</span>(task) {
  
    }
  )
)</code></pre></div>
<div id="specifying-basic-information" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-basic-information" class="anchor"></a>Specifying Basic Information</h2>
<table class="table">
<thead><tr class="header">
<th align="left">Field</th>
<th align="left">Possible Values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="left">id</td>
</tr>
<tr class="even">
<td align="left">packages</td>
<td align="left">package name as character variable</td>
</tr>
<tr class="odd">
<td align="left">features_types</td>
<td align="left">logical,integer,numeric,character,factor,ordered</td>
</tr>
<tr class="even">
<td align="left">predict_types</td>
<td align="left">response,se</td>
</tr>
<tr class="odd">
<td align="left">param_set</td>
<td align="left">ParamSet from the package paradox</td>
</tr>
<tr class="even">
<td align="left">properties</td>
<td align="left">missings,weights,parallel,importance</td>
</tr>
</tbody>
</table>
<p>First we need to define the learner’s name and unique identifier. Here we called the learner <code>ranger</code>. We use camel case for the R6 object’s name and lower case for the id. Available feature types, predict types and properties can be found in the table above. With the exception of <code>id</code> and <code>param_set</code>, the information must be written as character vectors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LearnerRegrRanger =<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">"LearnerRegrRanger"</span>, <span class="dt">inherit =</span> LearnerRegr,
  <span class="dt">public =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
    <span class="dt">initialize =</span> <span class="cf">function</span>(<span class="dt">id =</span> <span class="st">"regr.ranger"</span>) {
      super<span class="op">$</span><span class="kw">initialize</span>(
        <span class="dt">id =</span> id,
        <span class="dt">packages =</span> <span class="st">"ranger"</span>,
        <span class="dt">feature_types =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"logical"</span>, <span class="st">"integer"</span>, <span class="st">"numeric"</span>, <span class="st">"character"</span>, <span class="st">"factor"</span>, <span class="st">"ordered"</span>),
        <span class="dt">predict_types =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"response"</span>, <span class="st">"se"</span>),
        <span class="dt">param_set =</span> ParamSet<span class="op">$</span><span class="kw">new</span>(
          <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()
        ),
        <span class="dt">properties =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"weights"</span>, <span class="st">"importance"</span>)
      )
    },
    ...
  )
)</code></pre></div>
</div>
<div id="the-parameter-set" class="section level2">
<h2 class="hasAnchor">
<a href="#the-parameter-set" class="anchor"></a>The Parameter Set</h2>
<p>The parameter set must be specified as a <code>ParamSet</code> object from the package <code>paradox</code>, the rewrite of <code>paramhelpers</code>. Depending on its type (integer, double, factor or logical), you can define the hyperparameters of a learner including value ranges, special values and their defaults. For parameters which do not fit in any of the mentioned types, you can define untyped parameters as well.<br>
Additionally, you can set a tag <code>train</code> or <code>predict</code>, whether the parameter is used for training or prediction. When used for both, you can simply insert a character vector including both tags.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">...
param_set =<span class="st"> </span>ParamSet<span class="op">$</span><span class="kw">new</span>(
  <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
    ParamInt<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"num.trees"</span>, <span class="dt">default =</span> 500L, <span class="dt">lower =</span> 1L, <span class="dt">tags =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"train"</span>, <span class="st">"predict"</span>)),
    ParamInt<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"mtry"</span>, <span class="dt">lower =</span> 1L, <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamFct<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"importance"</span>, <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"none"</span>, <span class="st">"impurity"</span>, <span class="st">"impurity_corrected"</span>, <span class="st">"permutation"</span>), <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamLgl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"write.forest"</span>, <span class="dt">default =</span> <span class="ot">TRUE</span>, <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamInt<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"min.node.size"</span>, <span class="dt">default =</span> 5L, <span class="dt">lower =</span> 1L, <span class="dt">tags =</span> <span class="st">"train"</span>), <span class="co"># for probability == TRUE, def = 10</span>
    ParamLgl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"replace"</span>, <span class="dt">default =</span> <span class="ot">TRUE</span>, <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamDbl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"sample.fraction"</span>, <span class="dt">lower =</span> 0L, <span class="dt">upper =</span> 1L, <span class="dt">tags =</span> <span class="st">"train"</span>), <span class="co"># for replace == FALSE, def = 0.632</span>
    ParamFct<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"splitrule"</span>, <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"variance"</span>, <span class="st">"extratrees"</span>, <span class="st">"maxstat"</span>), <span class="dt">default =</span> <span class="st">"variance"</span>, <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamInt<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"num.random.splits"</span>, <span class="dt">lower =</span> 1L, <span class="dt">default =</span> 1L, <span class="dt">tags =</span> <span class="st">"train"</span>), <span class="co"># requires = quote(splitrule == "extratrees")</span>
    ParamDbl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"split.select.weights"</span>, <span class="dt">lower =</span> <span class="dv">0</span>, <span class="dt">upper =</span> <span class="dv">1</span>, <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamUty<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"always.split.variables"</span>, <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamFct<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"respect.unordered.factors"</span>, <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ignore"</span>, <span class="st">"order"</span>, <span class="st">"partition"</span>), <span class="dt">default =</span> <span class="st">"ignore"</span>, <span class="dt">tags =</span> <span class="st">"train"</span>), <span class="co"># for splitrule == "extratree= partition</span>
    ParamLgl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"scale.permutation.importance"</span>, <span class="dt">default =</span> <span class="ot">FALSE</span>, <span class="dt">tags =</span> <span class="st">"train"</span>), <span class="co">#requires = quote(importance == "permutation")</span>
    ParamLgl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"keep.inbag"</span>, <span class="dt">default =</span> <span class="ot">FALSE</span>, <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamLgl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"holdout"</span>, <span class="dt">default =</span> <span class="ot">FALSE</span>, <span class="dt">tags =</span> <span class="st">"train"</span>), 
    ParamInt<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"num.threads"</span>, <span class="dt">lower =</span> 1L, <span class="dt">tags =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"train"</span>, <span class="st">"predict"</span>)),
    ParamLgl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"save.memory"</span>, <span class="dt">default =</span> <span class="ot">FALSE</span>, <span class="dt">tags =</span> <span class="st">"train"</span>),
    ParamLgl<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"verbose"</span>, <span class="dt">default =</span> <span class="ot">TRUE</span>, <span class="dt">tags =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"train"</span>, <span class="st">"predict"</span>)),
    ParamInt<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"seed"</span>, <span class="dt">tags =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"train"</span>, <span class="st">"predict"</span>))
  )
)</code></pre></div>
</div>
<div id="train-function" class="section level2">
<h2 class="hasAnchor">
<a href="#train-function" class="anchor"></a>Train function</h2>
<p>After defining the learner’s general information, properties, prediction types and parameter space, its time to define the training function. This method only has the <code>task</code> object as input parameter. Within the function call you can access the hyperparameters used for training (defined by the tag in the parameter set) by <code>self$params_train</code>. Those parameters can be easily parsed to the learner specific training function. The function <code>invoke</code> by <code>mlr3misc</code> can be used to match the leaner’s parameters to its training function. Note that some training functions require a formula (which can be accessed by <code>task$formula</code>) or a special data format. The resulting model is stored within the learner object, i.e. in <code>self$model</code>. At the end, the learner itself is returned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train =<span class="st"> </span><span class="cf">function</span>(task) {
      pars =<span class="st"> </span>self<span class="op">$</span>params_train
      self<span class="op">$</span>model =<span class="st"> </span><span class="kw">invoke</span>(ranger<span class="op">::</span>ranger,
        <span class="dt">formula =</span> task<span class="op">$</span>formula,
        <span class="dt">data =</span> task<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(),
        <span class="dt">.args =</span> pars
      )
      self
    },</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#step-by-step-guide">Step-By-Step Guide</a><ul class="nav nav-pills nav-stacked">
<li><a href="#specifying-basic-information">Specifying Basic Information</a></li>
      <li><a href="#the-parameter-set">The Parameter Set</a></li>
      <li><a href="#train-function">Train function</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michel Lang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
